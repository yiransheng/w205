<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 0.9.5-beta" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="author" content="Yiran Sheng" />
  <title>W205 Lab 4</title>
  <style  class="link">
  /* ---------------------------------------------------
     Various settings to display madoko elements correctly.
     For example, lines in tables or a table of contents.
  
     All rules use specific madoko classes and never just
     a generic element. This means one can safely include
     this CSS into any web page without affecting non-madoko
     content.
  ----------------------------------------------------*/
  
  /* The table of  contents */
  .madoko .toc>.tocblock .tocblock .tocblock {
    margin-left: 2.5em;
  }
  
  .madoko .toc>.tocblock .tocblock {
    margin-left: 1.7em;
  }
  
  .madoko .toc>.tocblock>.tocitem {
    font-weight: bold;
  }
  
  .madoko .toc {
    margin-top: 1em;
  }
  
  /* Paragraphs */
  .madoko p.para-continue {
    margin-bottom: 0pt;
  }
  
  .madoko .para-block+p {
    margin-top: 0pt;
  }
  
  .madoko ul.para-block, .madoko ol.para-block {
    margin-top: 0pt;
    margin-bottom: 0pt;
  }
  
  .madoko ul.para-end, .madoko ol.para-end {
    margin-bottom: 1em;
  }
  
  .madoko dl {
    margin-left: 0em;
  }
  
  .madoko blockquote {
    font-style: italic;
  }
  
  /* Local page links do not get an underline unless hovering */
  .madoko a.localref {
    text-decoration: none;
  }
  .madoko a.localref:hover {
    text-decoration: underline;
  }
  
  /* Footnotes */
  .madoko .footnotes {
    font-size: smaller;
    margin-top: 2em;
  }
  
  .madoko .footnotes hr {
    width: 50%;
    text-align: left;
  }
  
  .madoko .footnote { 
    margin-left: 1em;
  }
  .madoko .footnote-before {
    margin-left: -1em;
    width: 1em;
    display: inline-block;
  }
  
  /* Abstract */
  .madoko .abstract>p:first-child:before {
    content: "Abstract. ";
    font-weight: bold;
  }
  
  .madoko .abstract {
    margin-left: 2.7em;
    margin-right: 2.7em;
    font-size: small;
  }
  
  
  /* Alignment */
  .madoko .align-center, .madoko .align-center>p {
    text-align: center !important;
  }
  
  .madoko .align-center pre {
    text-align: left;
  }
  
  .madoko .align-center>* {
    margin-left: auto !important;
    margin-right: auto !important;
  }
  
  .madoko .align-left, .madoko .align-left>p {
    text-align: left !important;
  }
  
  .madoko .align-left>* {
    margin-left: 0pt !important;
    margin-right: auto !important;
  }
  
  .madoko .align-right, .madoko .align-right>p {
    text-align: right !important;
  }
  
  .madoko .align-right>* {
    margin-left: auto !important;
    margin-right: 0pt !important;
  }
  
  .madoko .align-center>table,
  .madoko .align-left>table,
  .madoko .align-right>table {
    text-align: left !important;
  }
  
  
  /* Equations, Figure's etc. */
  .madoko .equation-before {
    float: right;
  }
  
  
  /* Bibliography */
  .madoko .bibitem {
    font-size: smaller;
  }
  
  .madoko .bib-numeric .bibitem {
    margin-left: 3em;
    text-indent: -3em;
  }
  
  .madoko .bibitem-before {
    display: none;
  }
  
  .madoko .bib-numeric .bibitem-before {
    display: inline-block;
    width: 3em;
    text-align: right;
  }
  
  .madoko .bibliography {
  }
  
  .madoko .bibsearch {
    font-size: x-small;
    text-decoration:none;
    color: black;
    font-family: "Segoe UI Symbol", Symbola;
  }
  
  /* General */
  .madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
    margin-top: 1ex;
    margin-bottom: 1ex;
  }
  
  .madoko .figure {
    padding: 0.5em;
    margin-left: 0pt;
    margin-right: 0pt;
  }
  
  .madoko .hidden {
    display: none;
  }
  
  .madoko .invisible {
    visibility: hidden;
  }
  
  .madoko.preview .invisible {
    visibility: visible;
    opacity: 0.5;
  }
  
  .madoko code.code, .madoko span.code {
    white-space: pre-wrap;
  }
  
  .madoko hr, hr.madoko {
    border: none;
    border-bottom: black solid 1px;
    margin-bottom: 0.5ex;
  }
  
  .madoko .framed>*:first-child {
    margin-top: 0pt;
  }
  .madoko .framed>*:last-child {
    margin-bottom: 0pt;
  }
  
  
  /* Title, authors */
  /*
  .madoko .title {
    font-size: xx-large;
    font-weight: bold;
    margin-bottom: 1ex;
  }
  
  .madoko .subtitle {
    font-size: x-large;
    margin-bottom: 1ex;
    margin-top: -1ex;
  }
  
  .madoko .titleblock>* {
    margin-left: auto;
    margin-right: auto;
    text-align: center;
  }
  
  .madoko .titleblock table {
    width: 80%;
  }
  
  .madoko .authorblock .author {
    font-size: large;
  }
  
  .madoko .titlenote {
    margin-top: -0.5ex;
    margin-bottom: 1.5ex;
  }
  */
  
  /* Lists */
  
  .madoko ul.list-star {
    list-style-type: disc;
  }
  
  .madoko ul.list-dash {
      list-style-type: none !important;
  }
  
  .madoko ul.list-dash > li:before {
      content: "\2013"; 
      position: absolute;
      margin-left: -1em; 
  }
  
  .madoko ul.list-plus {
    list-style-type: square;
  }
  
  /* Tables */
  .madoko table.madoko {
    border-collapse: collapse;
  }
  .madoko td, .madoko th {
    padding: 0ex 0.5ex;
    margin: 0pt;
    vertical-align: top;
  }
  
  .madoko .cell-border-left {
    border-left: 1px solid black;
  }
  .madoko .cell-border-right {
    border-right: 1px solid black;
  }
  
  
  .madoko thead>tr:first-child>.cell-line,
  .madoko tbody:first-child>tr:first-child>.cell-line {
    border-top: 1px solid black;
    border-bottom: none;
  }
  
  .madoko .cell-line, .madoko .cell-double-line {
    border-bottom: 1px solid black;
    border-top: none;
  }
  
  .madoko .cell-double-line {
    border-top: 1px solid black;
    padding-top: 1.5px !important;
  }
  
  
  /* Math Pre */
  .madoko .input-mathpre .MathJax_Display {
    text-align: left !important;
  }
  
  .madoko div.input-mathpre {
    text-align: left;
    margin-top: 1.5ex;
    margin-bottom: 1ex;
  }
  
  .madoko .math-rendering {
    color: gray;
  }
  
  /* Math */
  .madoko .mathdisplay {
    text-align: center;
  }
  
  
  /*---------------------------------------------------------------------------
    Default style for syntax highlighting
  ---------------------------------------------------------------------------*/
  
  .highlighted                        { color: black; }
  .highlighted .token.identifier      { }
  .highlighted .token.operators       { }
  .highlighted .token.keyword         { color: blue }
  .highlighted .token.string          { color: maroon } 
  .highlighted .token.string.escape   { color: gray }
  .highlighted .token.comment         { color: darkgreen }
  .highlighted .token.comment.doc     { font-style: normal }
  .highlighted .token.constant        { color: purple; }
  .highlighted .token.entity          {  }
  .highlighted .token.tag             { color: blue }
  .highlighted .token.info-token      { color: black }
  .highlighted .token.warn-token      { color: black }
  .highlighted .token.error-token     { color: darkred }
  .highlighted .token.debug-token     { color: gray }
  .highlighted .token.regexp          { color: maroon }
  .highlighted .token.attribute.name  { color: navy }
  .highlighted .token.attribute.value { color: maroon }
  .highlighted .token.constructor     { color: purple }
  .highlighted .token.namespace       { color: navy }
  .highlighted .token.header          { color: navy }
  .highlighted .token.type            { color: teal } 
  .highlighted .token.type.delimiter  { color: teal; } 
  .highlighted .token.predefined      { color: navy }
  .highlighted .token.invalid         { border-bottom: red dotted 1px }
  .highlighted .token.code            { color: maroon }
  .highlighted .token.code.keyword    { color: navy }
  .highlighted .token.typevar         { font-style: italic; }
  
  .highlighted .token.delimiter   {  } /* .[curly,square,parenthesis,angle,array,bracket] */
  .highlighted .token.number      {  }    /* .[hex,octal,binary,float] */
  .highlighted .token.variable    {  }  /* .[name,value]  */
  .highlighted .token.meta        { color: navy }      /* .[content] */
  
  .highlighted .token.bold            { font-weight: bold; }
  .highlighted .token.italic          { font-style: italic; }
  
  
  /* Pretty formatting of code */
  .madoko pre.pretty, .madoko code.pretty { 
    font-family: Cambria,Times,Georgia,serif;
    font-size: 100%;
  }
  
  .madoko .pretty table {
    border-collapse: collapse;
  }
  .madoko .pretty td {
    padding: 0em;
  }
  .madoko .pretty td.empty {
    min-width: 1.5ex;
  }
  .madoko .pretty td.expander {
    width: 100em;
  }
  .madoko .pretty .token.identifier         { font-style: italic }
  .madoko .pretty .token.constructor        { font-style: italic }
  
  
  /* ---------------------------------------------------
     Styling for full documents
  ----------------------------------------------------*/
  body.madoko {
    font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
    -webkit-text-size-adjust: 100%; /* so math displays well on mobile devices */
  }
  
  body.madoko {
    max-width: 88ex; /* about 88 characters */
    margin: 1em auto;
    padding: 0em 2em;  
  }
  
  body.preview.madoko {
    padding: 0em 1em;
  }
  
  .madoko p,
  .madoko li {
    text-align: justify;
  }
  
  /* style headings nicer, especially h5 and h6 */
  .madoko h1, .madoko h2, .madoko h3, .madoko h4 { 
    margin-top: 1.22em; 
    margin-bottom: 1ex;
  }
  .madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  { 
    margin-top: 1ex;    
  }
  .madoko h5, .madoko h6 { 
    margin-top: 1ex;
    font-size: 1em;
  }
  .madoko h5 { 
    margin-bottom: 0.5ex;
  }
  .madoko h5 + p {
    margin-top: 0.5ex;
  }
  .madoko h6 { 
    margin-bottom: 0pt;
  }
  .madoko h6 + p {
    margin-top: 0pt;
  }
  
  
  /* Fix monospace display (see http://code.stephenmorley.org/html-and-css/fixing-browsers-broken-monospace-font-handling/) */
  .madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt, .madoko .monospace, .madoko .token.indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
    font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
    font-size: 0.85em;
  }
  .madoko pre code, .madoko .token.indent {
    font-size: 0.95em;
  }
  
  .madoko pre code {
    font-family: inherit !important;
  }
  
  /* Code prettify */
  .madoko ol.linenums li {
    background-color: white;
    list-style-type: decimal;
  }
  
  /* Merging */
  .madoko .remote {
    background-color: #F0FFF0;
  }
  .madoko .remote + * {
    margin-top: 0pt;
  }
  
  /* ---------------------------------------------------
     Print settings
  ----------------------------------------------------*/
  
  @media print {
    body.madoko {
      font-size: 10pt;
    }
    @page {
      margin: 1in 1.5in;
    }
  }
  
  /* ---------------------------------------------------
     Mobile device settings
  ----------------------------------------------------*/
  
  @media only screen and (max-device-width:1024px) {
    body.madoko {
      padding: 0em 1em;
    }
  }
  
    </style>
  
  </head>
<body class="madoko">

<div class="body madoko" style="line-adjust:0">

<div class="titleblock align-center para-block" style="line-adjust:0">
<div class="titleheader align-center" style="line-adjust:0">
<div class="title para-block" style="font-size:xx-large;font-weight:bold;margin-bottom:0.5ex;line-adjust:0">W205 Lab 4</div></div>
<div class="authors align-center" style="width:80%;line-adjust:0"><table class="authorrow columns block" style="margin-top:2ex;width:100%;line-adjust:0">
<tbody><tr><td class="author column" style="text-align:center;line-adjust:0">
<div class="authorname" style="font-size:large;line-adjust:0">Yiran Sheng</div>
<div class="authoraddress" style="line-adjust:0">UC Berkeley</div>
<div class="authoremail email" style="line-adjust:0">yiran@ischool.berkeley.edu</div></td></tr></tbody></table></div></div>
<div class="abstract">
<p data-line="1"><span data-line="1"></span>W205 Lab 4 report. </p></div><h2 id="sec-questions"   style="bookmark:1.&#8194;Questions"><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span>Questions</h2><h3 id="sec-q1--how-would-partitioning-a-table-help"   style="bookmark:1.1.&#8194;Q1: How would partitioning a table help?"><span class="heading-before"><span class="heading-label">1.1</span>.&#8194;</span>Q1: How would partitioning a table help?</h3>
<p>Many times in practice, a query on Hive tables does not require full table scan. Instead, user needs filtering on specific columns. Partitioning lets Hive alter the way it manages the underlying structures of the table’s data directory, and use the directory structure itself as filters when querying the data, so that it only read the data file that the user is interested in for a given query. In non-partitioned tables, Hive would have to read all the files in a table’s data directory and subsequently apply filters on it. This is slow and expensive—especially in cases of large tables.
</p><h3 id="sec-q2--why-buckets-are-created-or-used"   style="bookmark:1.2.&#8194;Q2: Why buckets are created or used?"><span class="heading-before"><span class="heading-label">1.2</span>.&#8194;</span>Q2: Why buckets are created or used?</h3>
<p>Bucketing is another technique for decomposing data sets into more manageable parts. Iif we bucket the employee table and use employee_id as the bucketing column, the value of this column will be hashed by a user-defined number into buckets. <strong>Records with the same employee_id will always be stored in the same bucket.</strong> 
</p>
<p class="indent">Assuming the number of employee_id is much greater than the number of buckets, each bucket will have many employee_id. While creating table you can specify like CLUSTERED BY (employee_id) INTO XX BUCKETS ; where XX is the number of buckets . Bucketing has several advantages. The number of buckets is fixed so it does not fluctuate with data. If two tables are bucketed by employee_id, Hive can create a logically correct sampling. Bucketing also aids in doing efficient map-side joins etc.
</p>
<p class="indent"><strong>Refrence: </strong>&nbsp;<a href="http://stackoverflow.com/questions/19128940/what-is-the-difference-between-partitioning-and-bucketing-a-table-in-hive">http://stackoverflow.com/questions/19128940/what-is-the-difference-between-partitioning-and-bucketing-a-table-in-hive</a>
</p><h3 id="sec-q3--using-hive-on-tez-feature-would-it-help"   style="bookmark:1.3.&#8194;Q3: Using Hive on Tez feature, would it help?"><span class="heading-before"><span class="heading-label">1.3</span>.&#8194;</span>Q3: Using Hive on Tez feature, would it help?</h3>
<p>Tez is a new application framework built on Hadoop Yarn that generalizes map-reduce jobs into data processing tasks that can be modeled by a DAG. Map reduce jobs are a subset of Tez execution DAG.  
</p>
<p class="indent">Hive uses map-reduce as its execution engine. Any query will produce a graph of MR jobs potentially interspersed with some local/client-side work. This leads to many inefficiencies in the planning and execution of queries. 
</p>
<p class="indent">Hive on Tez improves Hive query performance by using more flexible Tez primitives while remains fully backward compatible with map-reduce execution plans. 
</p><h3 id="sec-q4--what-is-a-dag"   style="bookmark:1.4.&#8194;Q4: What is a DAG?"><span class="heading-before"><span class="heading-label">1.4</span>.&#8194;</span>Q4: What is a DAG?</h3>
<p>Directed acyclic graph, a graph with out circles. 
</p><h3 id="sec-q5--why-do-u-need-to-register-an-udf-before-using"   style="bookmark:1.5.&#8194;Q5: Why do u need to register an UDF before using?"><span class="heading-before"><span class="heading-label">1.5</span>.&#8194;</span>Q5: Why do u need to register an UDF before using?</h3>
<p>Because UDFs are be registered to the metastore, so they can be referenced in a query without having to create a temporary function each session.
</p><h2 id="sec-lab4-log"   style="bookmark:2.&#8194;Lab4 Log"><span class="heading-before"><span class="heading-label">2</span>.&#8194;</span>Lab4 Log</h2>
<pre class="para-block pre-fenced pre-fenced3"><code>Stage-Stage-1:    HDFS Read: 0 HDFS Write: 0 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 10.722 seconds
hive&gt; CREATE TABLE Web_Session_Log_Bucket
    &gt;  (DATETIME varchar(500),
    &gt;  USERID varchar(500),
    &gt;  SESSIONID varchar(500),
    &gt;  PRODUCTID varchar(500),
    &gt;  REFERERURL varchar(500))
    &gt;  COMMENT &#39;This is the Web Session Log data&#39;
    &gt;  PARTITIONED BY( PRDID STRING )
    &gt;  CLUSTERED BY(USERID) INTO 2 BUCKETS ROW FORMAT DELIMITED
    &gt;  FIELDS TERMINATED BY &#39;\t&#39;
    &gt; STORED AS TEXTFILE;
OK
Time taken: 0.167 seconds
hive&gt; set hive.enforce.bucketing = true;
hive&gt; FROM Web_Session_Log
    &gt; INSERT OVERWRITE TABLE Web_Session_Log_Bucket PARTITION
    &gt; (PRDID=&quot;/product/MT65XF2YA&quot;)
    &gt; SELECT *;
Query ID = root_20150927174646_29f5dda1-cddc-40e5-9a47-9a8e1fd195b8
Total jobs = 1
Launching Job 1 out of 1
Number of reduce tasks determined at compile time: 2
In order to change the average load for a reducer (in bytes):
  set hive.exec.reducers.bytes.per.reducer=&lt;number&gt;
In order to limit the maximum number of reducers:
  set hive.exec.reducers.max=&lt;number&gt;
In order to set a constant number of reducers:
  set mapreduce.job.reduces=&lt;number&gt;
Job running in-process (local Hadoop)
2015-09-27 17:46:06,699 Stage-1 map = 0%,  reduce = 0%
2015-09-27 17:46:10,780 Stage-1 map = 100%,  reduce = 0%
2015-09-27 17:46:14,020 Stage-1 map = 100%,  reduce = 100%
Ended Job = job_local893673299_0002
Loading data to table default.web_session_log_bucket partition (prdid=/product/MT65XF2YA)
Partition default.web_session_log_bucket{prdid=/product/MT65XF2YA} stats: [numFiles=2, numRows=40002, totalSize=5152990, rawDataSize=5112988]
MapReduce Jobs Launched:
Stage-Stage-1:    HDFS Read: 0 HDFS Write: 0 SUCCESS
Total MapReduce CPU Time Spent: 0 msec
OK
Time taken: 10.705 seconds
hive&gt; describe formatted Web_Session_Log;
OK
# col_name        data_type        comment

datetime        varchar(500)
userid            varchar(500)
sessionid        varchar(500)
productid        varchar(500)
refererurl        varchar(500)

# Detailed Table Information
Database:        default
Owner:            root
CreateTime:        Mon Sep 21 03:38:49 UTC 2015
LastAccessTime:     UNKNOWN
Protect Mode:        None
Retention:        0
Location:        file:/user/hive/warehouse/web_session_log
Table Type:        MANAGED_TABLE
Table Parameters:
    COLUMN_STATS_ACCURATE    true
    numFiles        1
    numRows         0
    rawDataSize        0
    totalSize        5192992
    transient_lastDdlTime    1442806944

# Storage Information
SerDe Library:        org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
InputFormat:        org.apache.hadoop.mapred.TextInputFormat
OutputFormat:        org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
Compressed:        No
Num Buckets:        -1
Bucket Columns:     []
Sort Columns:        []
Storage Desc Params:
    field.delim        \t
    serialization.format    \t
Time taken: 0.157 seconds, Fetched: 36 row(s)
</code></pre>
<div class="logomadoko block" style="text-align:right;font-size:xx-small;margin-top:4em"><span data-line="1"></span>Created with&nbsp;<a href="https://www.madoko.net">Madoko.net</a>.</div></div><span data-line=""></span>
</body>

</html>
